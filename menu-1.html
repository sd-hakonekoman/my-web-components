<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>Responsive Accessible Menu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="assets/css/header-1.css">
</head>

<body class="min-h-screen bg-gray-100 text-gray-900" data-menu-open="false">
  <header class="c-header-1">
    <!-- ここは「背景側」になり得る要素。メニューオープン中は inert 対象にする -->
    <div class="mx-auto max-w-5xl px-4 py-3 flex items-center justify-between gap-4">
      <div id="headerInert" class="flex items-center gap-4">
        <a href="#" class="font-semibold">Site Title</a>

        <!-- PC時の補助リンク例（オープン中 inert にしたいケース） -->
        <a href="#" class="hidden sm:inline text-sm text-gray-600 hover:underline">Help</a>
      </div>

      <!-- 開閉ボタン（SPのみ表示） -->
      <button
        type="button"
        id="menuButton"
        class="c-header-1__menuButton e-menuButton"
        aria-controls="siteNav"
        aria-expanded="false"
      >
        <!-- span 3本線 → × アニメ -->
        <span class="e-menuButton__lineWrapper" aria-hidden="true">
          <span data-icon="line1"></span>
          <span data-icon="line2"></span>
          <span data-icon="line3"></span>
        </span>

        <span class="sr-only" id="menuButtonLabel">メニューを開く</span>
      </button>

      <!-- PC用ナビ（横並び） -->
      <nav class="c-header-1__pcNav" aria-label="グローバルナビゲーション">
        <ul class="flex items-center gap-6 text-sm">
          <li><a class="hover:underline" href="#">About</a></li>
          <li><a class="hover:underline" href="#">Works</a></li>
          <li><a class="hover:underline" href="#">Contact</a></li>
        </ul>
      </nav>
    </div>

    <!-- SP用：オーバーレイ + オフキャンバスナビ（header 内に設置） -->
    <!-- overlay -->
    <div
      id="menuOverlay"
      class="c-header-1__overlay"
      aria-hidden="true"
    ></div>

    <!-- offcanvas nav -->
    <nav
      id="siteNav"
      class="c-header-1__spMenu"
      aria-label="グローバルナビゲーション"
      hidden
    >
      <div class="c-header-1__spMenuHead">
        <h2 class="text-base font-semibold">メニュー</h2>
        <!-- 閉じるはボタン共通にしているので、ここに独立ボタンは置かない前提 -->
        <!-- ただしUI的に必要なら置いてよい（アクセシビリティ的には問題なし） -->
      </div>

      <!-- 項目増加を想定：メニュー内スクロール -->
      <div class="flex-1 overflow-y-auto p-4">
        <ul class="space-y-2">
          <li><a class="block rounded px-2 py-2 hover:bg-gray-100" href="#">About</a></li>
          <li><a class="block rounded px-2 py-2 hover:bg-gray-100" href="#">Works</a></li>
          <li><a class="block rounded px-2 py-2 hover:bg-gray-100" href="#">Contact</a></li>

          <!-- ダミー（増える想定） -->
          <li><a class="block rounded px-2 py-2 hover:bg-gray-100" href="#">Item 04</a></li>
          <li><a class="block rounded px-2 py-2 hover:bg-gray-100" href="#">Item 05</a></li>
          <li><a class="block rounded px-2 py-2 hover:bg-gray-100" href="#">Item 06</a></li>
          <li><a class="block rounded px-2 py-2 hover:bg-gray-100" href="#">Item 07</a></li>
          <li><a class="block rounded px-2 py-2 hover:bg-gray-100" href="#">Item 08</a></li>
          <li><a class="block rounded px-2 py-2 hover:bg-gray-100" href="#">Item 09</a></li>
          <li><a class="block rounded px-2 py-2 hover:bg-gray-100" href="#">Item 10</a></li>
        </ul>
      </div>

      <div class="p-4 border-t text-sm text-gray-600">
        フッター要素などを置く場合はここに。
      </div>
    </nav>
  </header>

  <!-- 背景側（inert 対象） -->
  <main id="main" tabindex="-1" class="mx-auto max-w-5xl p-4" data-inert-target="true">
    <p class="mb-4">
      Tab / Shift+Tab / Escape / クリックで挙動を確認できます。SP幅でのみオフキャンバスが動作します。
    </p>
    <a href="#" class="inline-block rounded bg-white px-3 py-2 shadow hover:bg-gray-50">
      背景のリンク（メニューオープン中は操作不可にする）
    </a>
    <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Reiciendis ipsum saepe quibusdam, deleniti, aspernatur quas iusto reprehenderit dolores suscipit sunt sequi. Iusto cupiditate unde asperiores, praesentium amet officia, explicabo ad libero aut culpa voluptates deleniti earum exercitationem adipisci accusantium magnam! Delectus amet reprehenderit animi asperiores rem nihil eligendi est consequatur ab ratione doloribus fuga quas eaque dolorem, iusto quibusdam corporis deleniti consectetur. Aliquam quia, omnis nostrum consectetur nisi debitis magni enim odit vel cumque sunt blanditiis, dicta, cum nesciunt adipisci! Aliquam nulla iure aut, sit quidem minus cupiditate non distinctio ea esse facere tempore unde earum exercitationem enim odit saepe eum dolore labore illum excepturi, voluptatum est? Omnis expedita ea beatae eaque! Tenetur ad quisquam, temporibus ducimus at laudantium vel dicta eius fuga adipisci nobis rerum voluptates, fugit debitis? Eius hic ut quas eaque magni reiciendis suscipit. Dolor magni autem fuga nesciunt cumque porro necessitatibus sit impedit voluptatum optio dicta, sed iusto nostrum assumenda aut voluptas non atque et quod corporis temporibus facilis, fugit hic? Adipisci eaque asperiores cum laboriosam sit! Quo animi, odit quam, cumque laudantium consectetur ab sunt voluptate consequatur soluta consequuntur, sequi deserunt labore in. Laborum eaque facilis, placeat vitae ducimus, excepturi, nesciunt quia id adipisci est odit sequi! Ullam, qui? A alias inventore quia voluptate pariatur rem blanditiis recusandae hic earum cumque repellendus sunt ab, repellat, natus sed! Natus aliquam itaque asperiores quaerat fuga similique provident ex, magni magnam laboriosam totam voluptatibus rem placeat perspiciatis quisquam blanditiis deleniti maiores id numquam voluptate inventore et! Ex odio eaque, quibusdam ad, omnis perferendis nesciunt, in velit voluptatibus eum possimus odit atque necessitatibus voluptates officiis ducimus natus doloribus. Itaque temporibus perspiciatis hic sed, maiores laborum, doloribus natus, ratione sit repellendus sapiente earum optio dolore autem accusantium error recusandae saepe eveniet ab! Id voluptatum soluta dolorum harum quidem obcaecati voluptas quas, nemo omnis quibusdam eligendi recusandae cum rem debitis ullam culpa mollitia exercitationem eveniet dolorem. Explicabo in, error voluptatum perspiciatis consequuntur rem expedita consequatur, cumque aliquid accusamus quasi officia quae fuga pariatur adipisci maxime, sed dolores itaque id dolorem iusto recusandae repellat? Soluta aut possimus sit ea dignissimos rem et qui? Repellat ab consequatur totam. Et, ipsum dolorum! Deserunt sed suscipit facilis nobis distinctio! Natus illo ipsum soluta iste aut et quidem, fuga distinctio amet nisi debitis in, quasi placeat iure repellat est fugit ex quam voluptatibus molestiae dicta adipisci sequi harum. Quidem aspernatur consectetur nihil praesentium. Nihil impedit praesentium expedita obcaecati illum provident optio quam blanditiis veritatis sequi aspernatur exercitationem odit cupiditate quis iusto libero neque itaque excepturi, hic, unde deleniti nobis. Vel labore soluta nesciunt accusamus obcaecati tenetur recusandae fugiat magni. Corporis tempora eveniet, modi eum animi optio itaque quia hic dignissimos placeat porro aperiam est quidem sint omnis cupiditate! Id fugit mollitia hic quidem soluta. Labore, quaerat repellat voluptatem illo porro aliquid perferendis modi deserunt voluptates esse soluta consequatur totam nam quibusdam. Dicta laborum non soluta itaque sint ipsa a corrupti amet ullam asperiores, nemo ad dolorem, accusamus quasi. Qui voluptatum totam pariatur ea aliquid facilis vero tenetur hic ducimus saepe mollitia commodi eligendi explicabo animi inventore eaque, quibusdam temporibus architecto ipsam. Architecto culpa maiores, laborum numquam quas unde, similique nulla amet iste et, consequatur veritatis animi assumenda facere quidem doloremque debitis eos? Quibusdam error quisquam quidem odit dignissimos possimus, inventore repellat sapiente velit, quos voluptate unde! Temporibus dolorem et quod labore pariatur? Doloribus non ullam quos, quod deleniti quibusdam assumenda nisi. Aliquid impedit quidem nulla veniam quam, quod animi cupiditate error fugit corporis, voluptatum a voluptatibus quos minima, necessitatibus obcaecati. Reprehenderit libero veritatis consequatur sequi, aspernatur cumque quidem molestias facere quas? Corrupti ratione maxime quae corporis error sunt ad. Tenetur sapiente quasi animi pariatur consequuntur vel nesciunt modi nihil natus minima facilis totam dignissimos aliquam rem voluptate aspernatur iure, est maxime eos maiores eius praesentium officiis! Beatae nostrum dolorum ea. Est repellendus non voluptatem totam, magni quis ducimus molestiae itaque labore temporibus ullam facere expedita repellat nostrum eum dolorem quos assumenda? Nam non id quae praesentium animi suscipit neque possimus quis. Voluptatibus, quo expedita impedit officiis eveniet itaque distinctio recusandae magnam reprehenderit enim consequatur numquam officia, quibusdam doloribus possimus quasi? Enim totam corrupti saepe nesciunt, cumque dolorum quasi officia nobis architecto ullam culpa. Dolores, ratione incidunt pariatur labore corporis consequuntur corrupti ut! Aliquid maiores architecto nam ducimus? Porro assumenda quia temporibus labore quis. Architecto nisi dolores odio minus quis, sunt cumque quos labore aut eius consequuntur eveniet natus quia eligendi? Modi neque iste fugiat quia quibusdam aspernatur earum exercitationem maxime nemo, repellat magni, unde vero inventore. Debitis, nemo vero odit tempore id sint pariatur animi reprehenderit nulla libero quos voluptatum recusandae quidem ea fuga officia quas. Animi explicabo nesciunt delectus illo dolores ipsa iste voluptates vel aliquid ipsum autem deserunt optio doloremque maiores cum praesentium reiciendis architecto, voluptatum adipisci perspiciatis nobis magni omnis consequuntur? Est aspernatur suscipit nam magnam odit neque, iure perferendis, voluptatibus sit doloremque sequi mollitia numquam. Possimus maiores at labore dolorem ipsam est. Mollitia facere adipisci atque tempore corporis quo nobis, fugit qui harum quia accusantium voluptate, expedita doloremque quasi doloribus odit! Eligendi esse aspernatur suscipit eos nam repudiandae culpa modi maiores debitis totam error blanditiis nemo, eaque aliquam tempora fugiat omnis consectetur aperiam temporibus officia optio. Maiores vitae, aut consectetur repellendus voluptas eveniet nihil beatae debitis inventore, hic nemo accusamus in nam ducimus excepturi ea velit commodi exercitationem. Tempore odio alias expedita adipisci fugit sunt consequuntur doloremque provident, fugiat debitis labore beatae laborum quod repellendus totam animi. Corrupti, deleniti accusantium cupiditate eligendi, laboriosam est praesentium omnis ad ducimus deserunt totam quibusdam dolor animi! Vero officiis, dolores iure maiores sapiente iusto dicta eligendi deleniti sed, consectetur sunt quam! Magni iste minima, tempore accusantium nam fugit earum eligendi quas asperiores consectetur tempora deleniti, laboriosam facere possimus amet quos sequi enim animi voluptatum similique eos, reiciendis commodi. Magnam neque commodi corporis cupiditate hic distinctio delectus perferendis praesentium est. Aspernatur atque vitae, facere hic obcaecati sint aperiam possimus distinctio, fugiat ducimus vero tempora velit doloribus ad non amet optio! Quasi animi dolor, cumque nam quia aliquid?</p>
  </main>

  <footer class="mx-auto max-w-5xl p-4 text-sm text-gray-700" data-inert-target="true">
    <a href="#" class="hover:underline">Footer Link</a>
  </footer>

  <script>
    (() => {
      const body = document.body;

      const button = document.getElementById("menuButton");
      const label = document.getElementById("menuButtonLabel");
      const nav = document.getElementById("siteNav");
      const overlay = document.getElementById("menuOverlay");

      // inert 対象：main/footerに加え、header内の「ボタン以外」を個別に指定
      const headerInert = document.getElementById("headerInert");
      const inertTargets = [
        headerInert,
        ...document.querySelectorAll("[data-inert-target='true']")
      ].filter(Boolean);

      // SPのみ挙動を有効化（Tailwindの md に合わせて 768px を採用）
      const mq = window.matchMedia("(min-width: 768px)");

      let lastFocused = null;
      let scrollY = 0;

      const setIconState = (open) => {
        const lines = button.querySelectorAll("[data-icon]");
        lines.forEach((el) => el.dataset.open = open ? "true" : "false");
      };

      const setInert = (on) => {
        inertTargets.forEach((el) => {
          if (!el) return;
          if ("inert" in el) {
            el.inert = on;
          } else {
            // フォールバック：SRの読み上げ抑制（※フォーカス抑制にはならないため、フォーカストラップ必須）
            if (on) el.setAttribute("aria-hidden", "true");
            else el.removeAttribute("aria-hidden");
          }
        });
      };

      // iOS含め比較的安全なスクロールロック
      const lockScroll = () => {
        scrollY = window.scrollY;
        document.body.style.position = "fixed";
        document.body.style.top = `-${scrollY}px`;
        document.body.style.left = "0";
        document.body.style.right = "0";
        document.body.style.width = "100%";
      };

      const unlockScroll = () => {
        document.body.style.position = "";
        document.body.style.top = "";
        document.body.style.left = "";
        document.body.style.right = "";
        document.body.style.width = "";
        window.scrollTo(0, scrollY);
      };

      const getFocusable = (root) => {
        const selectors = [
          "a[href]",
          "button:not([disabled])",
          "input:not([disabled])",
          "select:not([disabled])",
          "textarea:not([disabled])",
          "[tabindex]:not([tabindex='-1'])"
        ];
        return Array.from(root.querySelectorAll(selectors.join(",")))
          .filter((el) => !el.hasAttribute("hidden") && el.offsetParent !== null);
      };

      const openMenu = () => {
        if (mq.matches) return; // PC幅では動作させない

        lastFocused = document.activeElement;

        body.dataset.menuOpen = "true";
        button.setAttribute("aria-expanded", "true");
        label.textContent = "メニューを閉じる";
        setIconState(true);

        nav.hidden = false;

        // アニメ開始：overlay/navを表示状態へ
        overlay.classList.remove("pointer-events-none");
        overlay.classList.add("opacity-100");

        nav.classList.remove("translate-x-full");
        nav.classList.add("translate-x-0");

        setInert(true);
        lockScroll();

        // フォーカス移動（nav内の最初へ）
        const focusables = getFocusable(nav);
        (focusables[0] ?? nav).focus?.();
      };

      const closeMenu = () => {
        body.dataset.menuOpen = "false";
        button.setAttribute("aria-expanded", "false");
        label.textContent = "メニューを開く";
        setIconState(false);

        // アニメで閉じる
        overlay.classList.add("pointer-events-none");
        overlay.classList.remove("opacity-100");

        nav.classList.add("translate-x-full");
        nav.classList.remove("translate-x-0");

        setInert(false);
        unlockScroll();

        // トランジション後に hidden を戻す（安全に）
        const durationMs = 200;
        window.setTimeout(() => {
          nav.hidden = true;
        }, durationMs);

        (lastFocused ?? button).focus();
        lastFocused = null;
      };

      const toggleMenu = () => {
        const expanded = button.getAttribute("aria-expanded") === "true";
        expanded ? closeMenu() : openMenu();
      };

      // クリック
      button.addEventListener("click", toggleMenu);
      overlay.addEventListener("click", () => {
        if (button.getAttribute("aria-expanded") === "true") closeMenu();
      });

      // キーボード：Esc + フォーカストラップ
      document.addEventListener("keydown", (e) => {
        const isOpen = button.getAttribute("aria-expanded") === "true";
        if (!isOpen) return;

        if (e.key === "Escape") {
          e.preventDefault();
          closeMenu();
          return;
        }

        if (e.key !== "Tab") return;

        const focusables = getFocusable(nav);
        if (focusables.length === 0) {
          e.preventDefault();
          return;
        }

        const first = focusables[0];
        const last = focusables[focusables.length - 1];

        if (e.shiftKey && document.activeElement === first) {
          e.preventDefault();
          last.focus();
        } else if (!e.shiftKey && document.activeElement === last) {
          e.preventDefault();
          first.focus();
        }
      });

      // メニュー内リンククリックで閉じる（SPでは一般的）
      nav.addEventListener("click", (e) => {
        const a = e.target.closest("a[href]");
        if (!a) return;
        closeMenu();
      });

      // PC幅に切り替わったら状態を強制リセット（重要）
      const resetIfDesktop = () => {
        if (!mq.matches) return;
        // PCではオフキャンバスは使わないので強制クローズ
        if (button.getAttribute("aria-expanded") === "true") closeMenu();

        // 念のため表示状態も初期化
        nav.hidden = true;
        overlay.classList.add("pointer-events-none");
        overlay.classList.remove("opacity-100");
        nav.classList.add("translate-x-full");
        nav.classList.remove("translate-x-0");
        setIconState(false);
      };

      mq.addEventListener("change", resetIfDesktop);
      resetIfDesktop();
    })();
  </script>
</body>
</html>
